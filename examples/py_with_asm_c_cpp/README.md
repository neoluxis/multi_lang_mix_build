# Python多语言库绑定示例

这个示例演示了如何在Python中使用三个不同语言实现的数学库：

- **C库**: 基本算术和位运算
- **汇编库**: 高性能数学运算
- **C++库**: 面向对象的高级数学功能

## 运行要求

### 1. 构建所有库

首先确保项目已完全构建：

```bash
cd /path/to/mix_multi_lang
mkdir build && cd build
cmake ..
make -j$(nproc)
```

### 2. 构建Python绑定

```bash
# 构建C库Python绑定（静态链接，无运行时依赖）
cd libs/c/bindings/python
python3 setup.py build_ext --inplace

# 构建汇编库Python绑定（静态链接，无运行时依赖）
cd ../../../libs/asm/bindings/python
python3 setup.py build_ext --inplace

# C++库Python绑定已在CMake构建时完成
```

### 3. 运行示例

**无需设置LD_LIBRARY_PATH！** C和汇编库使用静态链接，C++库编译时链接。

```bash
cd examples/py_with_asm_c_cpp
PYTHONPATH=/path/to/mix_multi_lang/libs/c/bindings/python:/path/to/mix_multi_lang/libs/asm/bindings/python:/path/to/mix_multi_lang/build/lib/python \
python3 demo.py
```

或者使用提供的运行脚本：

```bash
cd examples/py_with_asm_c_cpp
./run_demo.sh
```

## 故障排除

### 导入错误
如果遇到导入错误，请确保：

1. **所有库都已正确构建**
   ```bash
   cd build && make -j$(nproc)
   ```

2. **LD_LIBRARY_PATH设置正确**
   - 确保包含 `build/lib` 目录
   - 检查库文件是否存在：`ls build/lib/*.so`

3. **PYTHONPATH设置正确**
   - C库绑定：`libs/c/bindings/python`
   - 汇编库绑定：`libs/asm/bindings/python`
   - C++库绑定：`build/lib/python`

### 运行时错误
如果遇到运行时错误：

1. 检查LD_LIBRARY_PATH是否包含库目录
2. 确保所有依赖库都已安装
3. 检查Python版本兼容性（推荐Python 3.7+）

### 常见问题

**问题**: `libmath_ops.so: cannot open shared object file`
**解决**: 确保设置了正确的LD_LIBRARY_PATH

**问题**: `ModuleNotFoundError: No module named 'c_math'`
**解决**: 确保PYTHONPATH包含了正确的绑定目录

**问题**: 构建失败
**解决**: 确保安装了必要的构建工具（gcc, cmake, python-dev等）

## 示例内容

### 1. C库演示
- 基本算术运算（加减乘除模）
- 位运算（AND、OR、XOR）
- 错误处理

### 2. 汇编库演示
- 基本算术运算
- 阶乘计算
- 幂运算
- 位移操作

### 3. C++库演示
- 基本计算器功能
- 高级数学函数（幂、平方根、阶乘）
- 三角函数
- 计算历史记录
- 数组操作

### 4. 组合使用演示
展示如何将三个库的功能组合使用，完成复杂的计算流程。

### 5. 错误处理演示
展示各种错误情况的处理。

### 6. 性能对比测试
比较不同库在相同操作上的性能表现。

## 输出示例

```
🌟 多语言数学库Python绑定示例
============================================================
这个示例演示了如何在Python中同时使用三个不同语言实现的库:
• C库: 基本算术和位运算
• 汇编库: 高性能数学运算
• C++库: 面向对象的高级数学功能
============================================================

==================================================
🧮 C库演示 - 基本算术和位运算
==================================================

📊 基本算术运算:
  15 + 7 = 22
  15 - 7 = 8
  15 × 7 = 105
  15 ÷ 7 = 2
  15 % 7 = 1

🔢 位运算:
  12 AND 10 = 8  # 0b1100 & 0b1010 = 0b1000
  12 OR  10 = 14 # 0b1100 | 0b1010 = 0b1110
  12 XOR 10 = 6  # 0b1100 ^ 0b1010 = 0b110

==================================================
⚡ 汇编库演示 - 高性能数学运算
==================================================

📈 基本运算:
  25 + 7 = 32
  25 × 7 = 175

🚀 高级运算:
  6! = 720
  3^5 = 243

🔧 位运算:
  16 << 2 = 64

==================================================
🎯 C++库演示 - 面向对象高级功能
==================================================

🧮 基本计算器:
  10 + 3 = 13.0
  10 - 3 = 7.0
  10 × 3 = 30.0
  10 ÷ 3 = 3.333333

🔬 高级数学:
  2^8 = 256.0
  √16 = 4.0
  5! = 120.0

📐 三角函数:
  sin( 0°) = 0.000000, cos( 0°) = 1.000000
  sin(30°) = 0.500000, cos(30°) = 0.866025
  sin(45°) = 0.707107, cos(45°) = 0.707107
  sin(60°) = 0.866025, cos(60°) = 0.500000
  sin(90°) = 1.000000, cos(90°) = 0.000000

📝 计算历史:
  1. 10 + 3 = 13
  2. 10 - 3 = 7
  3. 10 * 3 = 30
  4. 10 / 3 = 3.33333
  5. 2 ^ 8 = 256

==================================================
🎪 组合使用演示
==================================================

🔄 计算流程: (2 + 3) × 4! ÷ √16
   分解步骤:
   1. C库加法: 2 + 3 = 5
   2. 汇编阶乘: 4! = 24
   3. C++平方根: √16 = 4.0
   4. C++乘法: 5 × 24 = 120.0
   5. C++除法: 120.0 ÷ 4.0 = 30.0

🎉 最终结果: 30.0

==================================================
🛡️  错误处理演示
==================================================

🚫 除零错误:
   C库: Division by zero
   C++库: CalculatorException: Division by zero!

🚫 无效输入:
   负数阶乘: Factorial is not defined for negative numbers
   负数平方根: Cannot calculate square root of negative number
   负数指数: Negative exponents not supported

==================================================
⚡ 性能对比测试
==================================================

⏱️  性能测试 (1000次调用):
------------------------------------------------------------
C库加法                    :     0.12 μs/call
汇编库加法                  :     0.11 μs/call
C++库加法                   :     0.15 μs/call
汇编阶乘                    :     0.13 μs/call
C++阶乘                     :     0.18 μs/call
汇编幂运算                  :     0.14 μs/call
C++幂运算                   :     0.16 μs/call

============================================================
🎊 示例完成！所有库都成功集成到Python中！
============================================================
```

## 技术特点

- **编译时链接**: C和汇编库使用Cython编译时链接，无运行时依赖
- **运行时链接**: C++库使用pybind11编译时链接
- **类型安全**: 所有绑定都提供完整的类型检查
- **错误处理**: 完善的异常处理和错误信息
- **性能优化**: 充分利用各语言的优势

## 架构优势

这个示例展示了现代软件开发的最佳实践：

1. **语言选择**: 为不同任务选择最适合的语言
2. **性能优化**: 关键代码使用低级语言实现
3. **易用性**: Python提供简单易用的接口
4. **可维护性**: 模块化设计，职责分离
5. **可扩展性**: 易于添加新的功能和语言

## 故障排除

### 导入错误
如果遇到导入错误，请确保：

1. 所有库都已正确构建
2. Python路径设置正确
3. 库文件在系统路径中

### 运行时错误
如果遇到运行时错误：

1. 检查LD_LIBRARY_PATH是否包含库目录
2. 确保所有依赖库都已安装
3. 检查Python版本兼容性

## 扩展示例

你可以基于这个示例：

- 添加更多数学函数
- 实现更复杂的算法
- 添加性能基准测试
- 创建Web API接口
- 集成到更大的应用中